# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v3

      # Runs a single command using the runners shell
      - name: Run a one-line script
        run: echo Hello, world!

      # Runs a set of commands using the runners shell
      - name: Run a multi-line script
        run: |
          echo Add other actions to build,
          echo test, and deploy your project.
name: Kaali-Linux

on:

    push:

    workflow_dispatch:

    

jobs:

  build:

    runs-on: ubuntu-20.04

    steps:

       - name: checkout kaali-linux

         uses: actions/checkout@main

       - uses: styfle/cancel-workflow-action@0.9.0

         name: "cancel duplicate workflow runs"

         with:

            all_but_latest: true

            access_token: ${{ github.token }}

       - name: initialization kaali-linux

         continue-on-error: true

         run: |

           git config --global user.name ${{ secrets.GIT_NAME }}

           git config --global user.email ${{ secrets.GIT_EMAIL }}

           git config --global credential.helper store

           echo "https://${{ secrets.GIT_NAME }}:${{ secrets.GIT_TOKEN }}@github.com" > ~/.git-credentials

       - name: cloning repository

         continue-on-error: true

         run: |

           git clone https://${{ secrets.GIT_NAME }}:${{ secrets.GIT_TOKEN }}@${{ secrets.BOT_REPO }} kaali

       - name: running kaali-linux server

         timeout-minutes: 350

         continue-on-error: true

         run: |

           cd kaali

           docker build . -t kaali

           docker run kaali

       - name: loop kaali-linux server

         continue-on-error: true

         run: |

              git clone https://github.com/${GITHUB_REPOSITORY} loop

              cd loop || exit 1

              echo $(date -u +%T%P) >> loop.txt

              git add loop.txt

              git commit -m "Kaali-Linux : Loop $(date -u +%D-%T%P)"

              git push -q https://${{ secrets.GIT_TOKEN }}@github.com/${GITHUB_REPOSITORY} HEAD:kaali-linux
